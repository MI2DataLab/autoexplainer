
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../changelog/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.3">
    
    
      
        <title>API documentation - AutoeXplainer</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6b71719e.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AutoeXplainer" class="md-header__button md-logo" aria-label="AutoeXplainer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AutoeXplainer
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API documentation
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://mi2datalab.github.io/autoexplainer/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Mi2Datalab
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AutoeXplainer" class="md-nav__button md-logo" aria-label="AutoeXplainer" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    AutoeXplainer
  </label>
  
    <div class="md-nav__source">
      <a href="https://mi2datalab.github.io/autoexplainer/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Mi2Datalab
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API documentation
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#autoexplainer" class="md-nav__link">
    AutoeXplainer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer" class="md-nav__link">
    autoexplainer.autoexplainer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer" class="md-nav__link">
    AutoExplainer
  </a>
  
    <nav class="md-nav" aria-label="AutoExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.aggregate" class="md-nav__link">
    aggregate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.evaluate" class="md-nav__link">
    evaluate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.get_best_explanation" class="md-nav__link">
    get_best_explanation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.to_html" class="md-nav__link">
    to_html()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.to_pdf" class="md-nav__link">
    to_pdf()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metric-handlers" class="md-nav__link">
    Metric handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics" class="md-nav__link">
    autoexplainer.metrics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics.AvgSensitivityHandler" class="md-nav__link">
    AvgSensitivityHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics.FaithfulnessEstimateHandler" class="md-nav__link">
    FaithfulnessEstimateHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics.IROFHandler" class="md-nav__link">
    IROFHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics.MetricHandler" class="md-nav__link">
    MetricHandler
  </a>
  
    <nav class="md-nav" aria-label="MetricHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoexplainer.metrics.MetricHandler.compute_metric_values" class="md-nav__link">
    compute_metric_values()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics.SparsenessHandler" class="md-nav__link">
    SparsenessHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explanation-methods-handlers" class="md-nav__link">
    Explanation methods handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers" class="md-nav__link">
    autoexplainer.explanations.explanation_handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.BestExplanation" class="md-nav__link">
    BestExplanation
  </a>
  
    <nav class="md-nav" aria-label="BestExplanation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.BestExplanation.evaluate" class="md-nav__link">
    evaluate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.BestExplanation.explain" class="md-nav__link">
    explain()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.ExplanationHandler" class="md-nav__link">
    ExplanationHandler
  </a>
  
    <nav class="md-nav" aria-label="ExplanationHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.ExplanationHandler.get_explanation_function" class="md-nav__link">
    get_explanation_function()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.GradCamHandler" class="md-nav__link">
    GradCamHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.IntegratedGradients" class="md-nav__link">
    IntegratedGradients
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.KernelShapHandler" class="md-nav__link">
    KernelShapHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.SaliencyHandler" class="md-nav__link">
    SaliencyHandler
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          Demo Reports
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Demo Reports" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Demo Reports
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reports/img_report.html" class="md-nav__link">
        Imagenette dataset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reports/cxr_report.html" class="md-nav__link">
        CXR dataset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reports/kp_report.html" class="md-nav__link">
        Kandinsky Patterns dataset
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#autoexplainer" class="md-nav__link">
    AutoeXplainer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer" class="md-nav__link">
    autoexplainer.autoexplainer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer" class="md-nav__link">
    AutoExplainer
  </a>
  
    <nav class="md-nav" aria-label="AutoExplainer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.aggregate" class="md-nav__link">
    aggregate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.evaluate" class="md-nav__link">
    evaluate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.get_best_explanation" class="md-nav__link">
    get_best_explanation()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.to_html" class="md-nav__link">
    to_html()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.autoexplainer.AutoExplainer.to_pdf" class="md-nav__link">
    to_pdf()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metric-handlers" class="md-nav__link">
    Metric handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics" class="md-nav__link">
    autoexplainer.metrics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics.AvgSensitivityHandler" class="md-nav__link">
    AvgSensitivityHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics.FaithfulnessEstimateHandler" class="md-nav__link">
    FaithfulnessEstimateHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics.IROFHandler" class="md-nav__link">
    IROFHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics.MetricHandler" class="md-nav__link">
    MetricHandler
  </a>
  
    <nav class="md-nav" aria-label="MetricHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoexplainer.metrics.MetricHandler.compute_metric_values" class="md-nav__link">
    compute_metric_values()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.metrics.SparsenessHandler" class="md-nav__link">
    SparsenessHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explanation-methods-handlers" class="md-nav__link">
    Explanation methods handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers" class="md-nav__link">
    autoexplainer.explanations.explanation_handlers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.BestExplanation" class="md-nav__link">
    BestExplanation
  </a>
  
    <nav class="md-nav" aria-label="BestExplanation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.BestExplanation.evaluate" class="md-nav__link">
    evaluate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.BestExplanation.explain" class="md-nav__link">
    explain()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.ExplanationHandler" class="md-nav__link">
    ExplanationHandler
  </a>
  
    <nav class="md-nav" aria-label="ExplanationHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.ExplanationHandler.get_explanation_function" class="md-nav__link">
    get_explanation_function()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.GradCamHandler" class="md-nav__link">
    GradCamHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.IntegratedGradients" class="md-nav__link">
    IntegratedGradients
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.KernelShapHandler" class="md-nav__link">
    KernelShapHandler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autoexplainer.explanations.explanation_handlers.SaliencyHandler" class="md-nav__link">
    SaliencyHandler
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api-documentation">API documentation</h1>
<h2 id="autoexplainer">AutoeXplainer</h2>


<div class="doc doc-object doc-module">


<a id="autoexplainer.autoexplainer"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="autoexplainer.autoexplainer.AutoExplainer" class="doc doc-heading">
        <code>AutoExplainer</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>The main class that evaluates a series of explanation methods and chooses the best one.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>raw_results</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Raw values of metrics computed for each observation for each explanation.</p></td>
        </tr>
        <tr>
          <td><code>first_aggregation_results</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Values of metrics aggregated across observations, i.e. each explanation
function has value for each metric.</p></td>
        </tr>
        <tr>
          <td><code>second_aggregation_results</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Values of metrics aggregated for each explanation method. Each explanation
method has single value, that represents overall quality.</p></td>
        </tr>
        <tr>
          <td><code>best_explanation_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of the selected best explanation found.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/autoexplainer.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AutoExplainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The main class that evaluates a series of explanation methods and chooses the best one.</span>
<span class="sd">    Attributes:</span>
<span class="sd">        raw_results (Dict): Raw values of metrics computed for each observation for each explanation.</span>
<span class="sd">        first_aggregation_results (Dict): Values of metrics aggregated across observations, i.e. each explanation</span>
<span class="sd">            function has value for each metric.</span>
<span class="sd">        second_aggregation_results (Dict): Values of metrics aggregated for each explanation method. Each explanation</span>
<span class="sd">            method has single value, that represents overall quality.</span>
<span class="sd">        best_explanation_name (str): Name of the selected best explanation found.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">KNOWN_EXPLANATION_HANDLERS</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;kernel_shap&quot;</span><span class="p">:</span> <span class="n">KernelShapHandler</span><span class="p">,</span>
        <span class="s2">&quot;integrated_gradients&quot;</span><span class="p">:</span> <span class="n">IntegratedGradients</span><span class="p">,</span>
        <span class="s2">&quot;grad_cam&quot;</span><span class="p">:</span> <span class="n">GradCamHandler</span><span class="p">,</span>
        <span class="s2">&quot;saliency&quot;</span><span class="p">:</span> <span class="n">SaliencyHandler</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">KNOWN_METRIC_HANDLERS</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;faithfulness_estimate&quot;</span><span class="p">:</span> <span class="n">FaithfulnessEstimateHandler</span><span class="p">,</span>
        <span class="s2">&quot;average_sensitivity&quot;</span><span class="p">:</span> <span class="n">AvgSensitivityHandler</span><span class="p">,</span>
        <span class="s2">&quot;irof&quot;</span><span class="p">:</span> <span class="n">IROFHandler</span><span class="p">,</span>
        <span class="s2">&quot;sparseness&quot;</span><span class="p">:</span> <span class="n">SparsenessHandler</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">KNOWN_FIRST_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="n">first_stage_aggregation_mean</span><span class="p">,</span>
        <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="n">first_stage_aggregation_median</span><span class="p">,</span>
        <span class="s2">&quot;max&quot;</span><span class="p">:</span> <span class="n">first_stage_aggregation_max</span><span class="p">,</span>
        <span class="s2">&quot;min&quot;</span><span class="p">:</span> <span class="n">first_stage_aggregation_min</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">KNOWN_SECOND_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rank_based&quot;</span><span class="p">:</span> <span class="n">second_stage_aggregation_rank_based</span><span class="p">,</span>
        <span class="s2">&quot;weighted_mean&quot;</span><span class="p">:</span> <span class="n">second_stage_aggregation_weighted_mean</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            model (torch.nn.Module): Convolutional neural network to be explained. On this model some explanation and metric</span>
<span class="sd">                parameters will be inferred.</span>
<span class="sd">            data (torch.Tensor): Data that will be used for explanation method evaluation. shape: (N, C, H, W).</span>
<span class="sd">            targets (torch.Tensor): Labels for provided data. Encoded as integer vector with shape (N,).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_second_stage_aggregation_function_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_stage_aggregation_function_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">second_aggregation_results</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">fix_relus_in_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_results</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics_aggregated</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times_total</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">explanations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">explanation_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">metrics_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluates explanation methods. Stores results in ``.raw_results`` attribute.</span>
<span class="sd">        Args:</span>
<span class="sd">            explanations (List[str]): List of names of explanation methods to be evaluated.</span>
<span class="sd">                                      By default, uses all available explanation methods.</span>
<span class="sd">                                      Accepts lists with subset of: ``{&quot;saliency&quot;, &quot;grad_cam&quot;, &quot;integrated_gradients&quot;, &quot;kernel_shap&quot;}``.</span>
<span class="sd">            metrics (List[str]): List of names of evaluation metrics to be used. By default, uses all available metrics.</span>
<span class="sd">                                Accepts lists with subset of: ``{&quot;irof&quot;, &quot;sparseness&quot;, &quot;average_sensitivity&quot;, &quot;faithfulness_estimate&quot;}``.</span>
<span class="sd">            explanation_params (Dict[str, Dict]): Allows to override default parameters of selected explanation functions.</span>
<span class="sd">                                                Accept Dictionary with form ``{&quot;explanation_name&quot;: &lt;Dictionary with parameters&gt;}``.</span>
<span class="sd">                                                See corresponding ExplanationHandler to see what parameters are accepted.</span>
<span class="sd">            metrics_params (Dict[str, Dict]): Allows to override default parameters of selected metrics.</span>
<span class="sd">                                              Accept Dictionary with form ``{&quot;metric_name&quot;: &lt;Dictionary with parameters&gt;}``.</span>
<span class="sd">                                              See corresponding MetricHandler to see what parameters are accepted.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_method_and_metric_names</span><span class="p">(</span><span class="n">explanations</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">explanations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">explanations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_EXPLANATION_HANDLERS</span>
        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_METRIC_HANDLERS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_method_and_metric_params_dicts</span><span class="p">(</span><span class="n">explanations</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">explanation_params</span><span class="p">,</span> <span class="n">metrics_params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">explanation_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">explanation_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">metrics_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metrics_params</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Preparing explanation methods and metric handlers...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">explanation_name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_EXPLANATION_HANDLERS</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">](</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">explanation_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">explanation_name</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">explanation_name</span> <span class="ow">in</span> <span class="n">explanations</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">metric_name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_METRIC_HANDLERS</span><span class="p">[</span><span class="n">metric_name</span><span class="p">](</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">metrics_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metrics</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="n">metric_name</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">}</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Number of explanation methods to evaluate: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Explanation methods selected: &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Number of metrics used during evaluation: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Metrics selected: &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">METRIC_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Creating attributions&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">explanation_name</span><span class="p">,</span> <span class="n">explanation_handler</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating attributions for </span><span class="si">{</span><span class="n">explanation_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">explanation_handler</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">explanation_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_results</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating attribution finished. Starting evaluation.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Evaluation may take a very long time, please be patient...&quot;</span><span class="p">)</span>

        <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span>
            <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">),</span>
            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluating metrics&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_handler</span><span class="p">),</span> <span class="p">(</span><span class="n">explanation_name</span><span class="p">,</span> <span class="n">explanation_handler</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluating: method </span><span class="si">{</span><span class="n">explanation_name</span><span class="si">}</span><span class="s2"> and metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_results</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_handler</span><span class="o">.</span><span class="n">compute_metric_values</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="n">targets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                <span class="n">attributions</span><span class="o">=</span><span class="n">explanation_handler</span><span class="o">.</span><span class="n">attributions</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
                <span class="n">explanation_func</span><span class="o">=</span><span class="n">explanation_handler</span><span class="o">.</span><span class="n">get_explanation_function</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">][</span><span class="n">explanation_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
                <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">],</span> <span class="mi">3</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics_aggregated</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">metric_name</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">times_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times_total</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">times_metrics_aggregated</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluating metrics finished after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">times_total</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">first_stage_aggregation_function_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">second_stage_aggregation_function_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rank_based&quot;</span><span class="p">,</span>
        <span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Aggregates raw result computed in .evaluate() method in two steps. First, aggregates metric scores across</span>
<span class="sd">        provided observations, i.e. each explanation method has a  value for each metric. Secondly, aggregates</span>
<span class="sd">        scores across available metrics, i.e. each explanation method has a single value that represents overall quality.</span>

<span class="sd">        Stores both aggregation steps in the attributes ``first_aggregation_results`` and ``second_aggregation_results``.</span>

<span class="sd">        Args:</span>
<span class="sd">            first_stage_aggregation_function_name ({&quot;mean&quot;, &quot;median&quot;, &quot;min&quot;,&quot;max&quot;}): Name of the function for the first stage aggregation.</span>
<span class="sd">            second_stage_aggregation_function_name ({&quot;mean&quot;, &quot;median&quot;, &quot;min&quot;,&quot;max&quot;}): Name of the function for second stage aggregaton.</span>
<span class="sd">            second_stage_aggregation_function_aggregation_parameters (Dict): Parameters for the second stage aggregation function.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_after_evaluation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_aggregation_parameters</span><span class="p">(</span>
            <span class="n">first_stage_aggregation_function_name</span><span class="p">,</span>
            <span class="n">second_stage_aggregation_function_name</span><span class="p">,</span>
            <span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_stage_aggregation_function_name</span> <span class="o">=</span> <span class="n">first_stage_aggregation_function_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_second_stage_aggregation_function_name</span> <span class="o">=</span> <span class="n">second_stage_aggregation_function_name</span>

        <span class="k">if</span> <span class="n">second_stage_aggregation_function_aggregation_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">second_stage_aggregation_function_aggregation_parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_FIRST_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">[</span>
            <span class="n">first_stage_aggregation_function_name</span>
        <span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_results</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">second_aggregation_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_SECOND_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">[</span>
            <span class="n">second_stage_aggregation_function_name</span>
        <span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span><span class="p">,</span> <span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">)</span>
        <span class="n">sorted_results</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_aggregation_results</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">best_result</span><span class="p">,</span> <span class="n">second_best_result</span> <span class="o">=</span> <span class="n">sorted_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sorted_results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">best_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">second_best_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="p">[</span><span class="n">best_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="p">[</span><span class="n">second_best_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                    <span class="n">best_result</span> <span class="o">=</span> <span class="n">second_best_result</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span> <span class="o">=</span> <span class="n">best_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span> <span class="o">=</span> <span class="n">sorted_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;first_stage_aggregation_function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_FIRST_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">[</span>
                <span class="n">first_stage_aggregation_function_name</span>
            <span class="p">],</span>
            <span class="s2">&quot;second_stage_aggregation_function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_SECOND_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">[</span>
                <span class="n">second_stage_aggregation_function_name</span>
            <span class="p">],</span>
            <span class="s2">&quot;second_stage_aggregation_function_aggregation_parameters&quot;</span><span class="p">:</span> <span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">to_html</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates evaluation report as HTML file.</span>
<span class="sd">        Args:</span>
<span class="sd">            file_path (str): Target file path.</span>
<span class="sd">            model_name (str): Name of model to show inside report.</span>
<span class="sd">            dataset_name (str): Name of dataset to show inside report.</span>
<span class="sd">            labels (Dict[int,str]): Mapping between class number and class names. e.g. ``{0:&quot;dog&quot;, 1:&quot;cat&quot;, 2:&quot;fish&quot;}`` for labels</span>
<span class="sd">                                    inside report.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Aggregated results are needed for report generation.&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_aggregation_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Aggregated results are needed for report generation.&quot;</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">PackageLoader</span><span class="p">(</span><span class="s2">&quot;autoexplainer&quot;</span><span class="p">))</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;report.html&quot;</span><span class="p">)</span>

        <span class="n">report_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info_for_report</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

        <span class="n">pic_io_bytes</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;fig_with_examples&quot;</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pic_io_bytes</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
        <span class="n">pic_io_bytes</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pic_hash</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pic_io_bytes</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">float_columns</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;result_dataframe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>

        <span class="n">html_table</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;result_dataframe&quot;</span><span class="p">]</span>
            <span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span>
                <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Agg. Score&quot;</span><span class="p">,</span> <span class="s2">&quot;Explanation Name&quot;</span><span class="p">],</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;font-weight&quot;</span><span class="p">:</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="s2">&quot;text-align&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="n">border</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="o">.</span><span class="n">hide_index</span><span class="p">()</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">float_columns</span><span class="p">)</span>
            <span class="o">.</span><span class="n">render</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">rendered</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span>
            <span class="n">dataframe_html</span><span class="o">=</span><span class="n">html_table</span><span class="p">,</span>
            <span class="n">pic_hash</span><span class="o">=</span><span class="n">pic_hash</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
            <span class="o">**</span><span class="n">report_info</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">results</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_pdf</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name of the model&quot;</span><span class="p">,</span>
        <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name of the dataset&quot;</span><span class="p">,</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates PDF report from dict stored in the attribute ``first_aggregation_results``.</span>
<span class="sd">        Needs Latex packages installed to run - see README.</span>

<span class="sd">        Args:</span>
<span class="sd">            folder_path (str): Path to directory, where the reports (PDF and tex) should be created.</span>
<span class="sd">            model_name (str): Name of model to show inside report.</span>
<span class="sd">            dataset_name (str): Name of dataset to show inside report.</span>
<span class="sd">            labels (Dict[int,str]): Mapping between class number and class names. e.g. ``{0:&quot;dog&quot;, 1:&quot;cat&quot;, 2:&quot;fish&quot;}`` for labels</span>
<span class="sd">                                    inside report.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_after_aggregation</span><span class="p">()</span>

        <span class="n">tex_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s2">&quot;report.tex&quot;</span><span class="p">)</span>
        <span class="n">pdf_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s2">&quot;report.pdf&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tex_file</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tex_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pdf_file</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pdf_file</span><span class="p">)</span>

        <span class="n">report_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info_for_report</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

        <span class="n">left_margin</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">max_nr_columns_in_table</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">geometry_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tmargin&quot;</span><span class="p">:</span> <span class="s2">&quot;2cm&quot;</span><span class="p">,</span> <span class="s2">&quot;lmargin&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_margin</span><span class="si">}</span><span class="s2">cm&quot;</span><span class="p">}</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">geometry_options</span><span class="o">=</span><span class="n">geometry_options</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;AutoeXplainer Report&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Package</span><span class="p">(</span><span class="s2">&quot;hyperref&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Package</span><span class="p">(</span><span class="s2">&quot;booktabs&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\maketitle&quot;</span><span class="p">))</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;result_dataframe&quot;</span><span class="p">]</span>

        <span class="n">metric_name_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">METRIC_NAME_SHORT_TO_LONG</span><span class="p">)</span>
        <span class="n">metric_name_copy</span><span class="p">[</span><span class="s2">&quot;explanation_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;explanation name&quot;</span>
        <span class="n">metric_name_copy</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Rank&quot;</span>
        <span class="n">metric_name_copy</span><span class="p">[</span><span class="s2">&quot;Agg. Score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Agg. Score&quot;</span>
        <span class="n">explanation_methods</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;methods&quot;</span><span class="p">]</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span>
        <span class="n">metrics_used</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;explanation name&quot;</span><span class="p">,</span> <span class="s2">&quot;Rank&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">metrics</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Agg. Score&quot;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">hyperlink</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoEscape</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
            <span class="k">return</span> <span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\href{&quot;</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s2">&quot;}{&quot;</span> <span class="o">+</span> <span class="n">escape_latex</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">)</span>

        <span class="c1"># create content of  the Document</span>
        <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;General information&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Model name: &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Dataset name: &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Execution time: &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;execution_time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> s </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Package version: &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;autoexplainer_version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Date: &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Selected method: &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;selected_method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Number of images: &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;n_images&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;Model performance&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Accuracy: &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;model_acc&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;F1 macro: &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;model_f1_macro&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Balanced accuracy: &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;model_bac&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;Table of results&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\begin</span><span class="si">{footnotesize}</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\begin</span><span class="si">{flushleft}</span><span class="s2"> &quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;result_dataframe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{flushleft}</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{footnotesize}</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Table description </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;Arrow next to the metric names indicates whether larger or smaller values of metric are better. Time elapsed shows time that was required for computation of attribution for given batch of images. When there is a tie in Aggregated Score, the best metric is chosen based on computation time.&quot;</span>
            <span class="p">)</span>

        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NewPage</span><span class="p">())</span>
        <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;Details&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
            <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s2">&quot;Explanations:&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
                <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Itemize</span><span class="p">())</span> <span class="k">as</span> <span class="n">itemize</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])):</span>
                        <span class="n">explanation_name</span> <span class="o">=</span> <span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">explanation_methods</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                        <span class="n">itemize</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="n">explanation_name</span><span class="p">))</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EXPLANATION_DESCRIPTION</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">explanation_name</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">hyperlink</span><span class="p">(</span>
                                <span class="n">EXPLANATION_DESCRIPTION</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">explanation_name</span><span class="p">)][</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">EXPLANATION_DESCRIPTION</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">explanation_name</span><span class="p">)][</span><span class="mi">2</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Explanation&#39;s parameters: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\texttt{&quot;</span><span class="p">))</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;method_parameters&#39;</span><span class="p">][</span><span class="n">explanation_methods</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;}&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NewPage</span><span class="p">())</span>
            <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s2">&quot;Metrics:&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
                <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Itemize</span><span class="p">())</span> <span class="k">as</span> <span class="n">itemize</span><span class="p">:</span>
                    <span class="n">minus</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Time elapsed [s]&quot;</span><span class="p">:</span>
                            <span class="n">minus</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">itemize</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="n">METRIC_NAME_MEDIUM_TO_LONG</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
                            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">METRIC_DESCRIPTIONS</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">hyperlink</span><span class="p">(</span>
                                    <span class="n">METRIC_DESCRIPTIONS</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">1</span><span class="p">],</span> <span class="n">METRIC_DESCRIPTIONS</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">2</span><span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Metric&#39;s parameters: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\texttt{&quot;</span><span class="p">))</span>
                            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;metric_parameters&#39;</span><span class="p">][</span><span class="n">metrics_used</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">minus</span><span class="p">]]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;}&quot;</span><span class="p">))</span>
            <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s2">&quot;Aggregation parameters&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\texttt{&quot;</span><span class="p">))</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;aggregation_parameters&quot;</span><span class="p">])</span>
                <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;}&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NewPage</span><span class="p">())</span>
        <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;Examples of explanations&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
            <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Figure</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s2">&quot;!h&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">mini_logo</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;fig_with_examples&quot;</span><span class="p">]</span>
                <span class="n">mini_logo</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">21</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">left_margin</span><span class="si">}</span><span class="s2">cm&quot;</span><span class="p">)</span>

        <span class="n">doc</span><span class="o">.</span><span class="n">generate_pdf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s2">&quot;report&quot;</span><span class="p">),</span> <span class="n">clean_tex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_best_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BestExplanation</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an object with the selected best explanation method wrapped with a few additions, see BestExplanation for more details.</span>
<span class="sd">        Returns (BestExplanation): BestExplanation object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_after_aggregation</span><span class="p">()</span>
        <span class="n">best_explanation_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">BestExplanation</span><span class="p">(</span>
            <span class="n">attributions</span><span class="o">=</span><span class="n">best_explanation_handler</span><span class="o">.</span><span class="n">attributions</span><span class="p">,</span>
            <span class="n">explanation_function</span><span class="o">=</span><span class="n">best_explanation_handler</span><span class="o">.</span><span class="n">get_explanation_function</span><span class="p">(),</span>
            <span class="n">explanation_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span><span class="p">,</span>
            <span class="n">explanation_function_parameters</span><span class="o">=</span><span class="n">best_explanation_handler</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">,</span>
            <span class="n">metric_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">,</span>
            <span class="n">aggregation_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aggregation_parameters</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_info_for_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">dict_list_for_df</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>  <span class="c1"># noqa: B007</span>
            <span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">dict_list_for_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span><span class="p">[</span><span class="n">methods</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">methods_full_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">]</span>
        <span class="n">metrics_full_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">METRIC_NAME_LONG_TO_MEDIUM</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_list_for_df</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">methods_full_names</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">metrics_full_names</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Time elapsed [s]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
            <span class="p">{</span><span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="p">)</span>
        <span class="n">agg_score</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_aggregation_results</span><span class="p">)</span>
        <span class="n">agg_score</span> <span class="o">=</span> <span class="n">agg_score</span><span class="o">.</span><span class="n">set_axis</span><span class="p">([</span><span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">agg_score</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Agg. Score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">agg_score</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;Agg. Score&quot;</span><span class="p">,</span> <span class="s2">&quot;Time elapsed [s]&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">cols</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">cols</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;index&quot;</span><span class="p">:</span> <span class="s2">&quot;Explanation Name&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">method_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">metric_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">pp</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_plot_for_report</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

        <span class="n">metric_parameters</span> <span class="o">=</span> <span class="n">extract_function_names</span><span class="p">(</span><span class="n">metric_parameters</span><span class="p">)</span>
        <span class="n">method_parameters</span> <span class="o">=</span> <span class="n">extract_function_names</span><span class="p">(</span><span class="n">method_parameters</span><span class="p">)</span>

        <span class="n">aggregation_parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;first_stage_aggregation_function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first_stage_aggregation_function_name</span><span class="p">,</span>
            <span class="s2">&quot;second_stage_aggregation_function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_second_stage_aggregation_function_name</span><span class="p">,</span>
            <span class="s2">&quot;second_stage_aggregation_function_aggregation_parameters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_parameters</span><span class="p">[</span>
                <span class="s2">&quot;second_stage_aggregation_function_aggregation_parameters&quot;</span>
            <span class="p">],</span>
        <span class="p">}</span>
        <span class="n">n_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
        <span class="n">aggregation_parameters_str</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">pformat</span><span class="p">(</span><span class="n">aggregation_parameters</span><span class="p">)</span>
        <span class="n">model_performance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_model_performance</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;execution_time&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_total</span><span class="p">,</span>
            <span class="s2">&quot;selected_method&quot;</span><span class="p">:</span> <span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span><span class="p">],</span>
            <span class="s2">&quot;result_dataframe&quot;</span><span class="p">:</span> <span class="n">df</span><span class="p">,</span>
            <span class="s2">&quot;methods&quot;</span><span class="p">:</span> <span class="n">methods</span><span class="p">,</span>
            <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
            <span class="s2">&quot;aggregation_parameters&quot;</span><span class="p">:</span> <span class="n">aggregation_parameters_str</span><span class="p">,</span>
            <span class="s2">&quot;method_parameters&quot;</span><span class="p">:</span> <span class="n">method_parameters</span><span class="p">,</span>
            <span class="s2">&quot;metric_parameters&quot;</span><span class="p">:</span> <span class="n">metric_parameters</span><span class="p">,</span>
            <span class="s2">&quot;autoexplainer_version&quot;</span><span class="p">:</span> <span class="n">_get_package_version</span><span class="p">(),</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">(),</span>
            <span class="s2">&quot;fig_with_examples&quot;</span><span class="p">:</span> <span class="n">fig</span><span class="p">,</span>
            <span class="s2">&quot;n_images&quot;</span><span class="p">:</span> <span class="n">n_images</span><span class="p">,</span>
            <span class="o">**</span><span class="n">model_performance</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_evaluate_model_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
        <span class="n">predicted_labels</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">y_true</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;model_acc&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
            <span class="s2">&quot;model_f1_macro&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
            <span class="s2">&quot;model_bac&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_generate_plot_for_report</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">count_of_images</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
        <span class="n">number_of_explanations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">)</span>
        <span class="n">number_of_columns</span> <span class="o">=</span> <span class="n">number_of_explanations</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">number_of_images</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count_of_images</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">ids_of_images_to_show</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">number_of_classes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span>
        <span class="n">images_per_class</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">number_of_images</span> <span class="o">/</span> <span class="n">number_of_classes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">class_id</span> <span class="ow">in</span> <span class="n">classes</span><span class="p">:</span>
            <span class="n">ids_of_images_from_this_class</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">class_id</span>
            <span class="p">]</span>
            <span class="n">ids_of_images_to_show</span> <span class="o">+=</span> <span class="n">ids_of_images_from_this_class</span><span class="p">[:</span><span class="n">images_per_class</span><span class="p">]</span>

        <span class="n">number_of_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids_of_images_to_show</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1.6</span> <span class="o">*</span> <span class="n">number_of_images</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">ImageGrid</span><span class="p">(</span>
            <span class="n">fig</span><span class="p">,</span>
            <span class="mi">111</span><span class="p">,</span>
            <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="n">number_of_images</span><span class="p">,</span> <span class="n">number_of_columns</span><span class="p">),</span>
            <span class="n">axes_pad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">share_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
        <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;red-white-green&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">])</span>
        <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>

        <span class="n">images_to_plot</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Original image&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="k">for</span> <span class="n">original_image</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ids_of_images_to_show</span><span class="p">]:</span>
            <span class="n">images_to_plot</span><span class="p">[</span><span class="s2">&quot;Original image&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">normalize_image</span><span class="p">(</span><span class="n">torch_image_to_numpy_image</span><span class="p">(</span><span class="n">original_image</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">explanation_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">:</span>
            <span class="n">attributions_to_plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">]</span><span class="o">.</span><span class="n">attributions</span><span class="p">[</span><span class="n">ids_of_images_to_show</span><span class="p">]</span>
            <span class="n">full_explanation_name</span> <span class="o">=</span> <span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">]</span>
            <span class="n">images_to_plot</span><span class="p">[</span><span class="n">full_explanation_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">attribution</span> <span class="ow">in</span> <span class="n">attributions_to_plot</span><span class="p">:</span>
                <span class="n">attribution</span> <span class="o">=</span> <span class="n">torch_image_to_numpy_image</span><span class="p">(</span><span class="n">attribution</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">explanation_name</span> <span class="o">==</span> <span class="s2">&quot;integrated_gradients&quot;</span><span class="p">:</span>
                    <span class="n">attribution</span><span class="p">[</span><span class="n">attribution</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">attribution</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">attribution</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">)</span>
                    <span class="n">attribution</span><span class="p">[</span><span class="n">attribution</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">attribution</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">attribution</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="n">attribution_scaled</span> <span class="o">=</span> <span class="n">attribution</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">attribution</span><span class="p">))</span>
                <span class="n">images_to_plot</span><span class="p">[</span><span class="n">full_explanation_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attribution_scaled</span><span class="p">)</span>

        <span class="n">order_of_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Original image&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">explanation_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">column_num</span><span class="p">,</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">order_of_columns</span><span class="p">):</span>
            <span class="n">grid</span><span class="p">[</span><span class="n">column_num</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row_num</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images_to_plot</span><span class="p">[</span><span class="n">column_name</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">column_name</span> <span class="o">==</span> <span class="s2">&quot;Original image&quot;</span><span class="p">:</span>
                    <span class="n">grid</span><span class="p">[</span><span class="n">row_num</span> <span class="o">*</span> <span class="n">number_of_columns</span> <span class="o">+</span> <span class="n">column_num</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">grid</span><span class="p">[</span><span class="n">row_num</span> <span class="o">*</span> <span class="n">number_of_columns</span> <span class="o">+</span> <span class="n">column_num</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_images</span><span class="p">):</span>
            <span class="n">image_for_prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ids_of_images_to_show</span><span class="p">[</span><span class="n">row_num</span><span class="p">]]</span>
            <span class="n">model_predition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">image_for_prediction</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">predicted_class</span> <span class="o">=</span> <span class="n">model_predition</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">predicted_class_softmax</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">model_predition</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="n">class_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="n">ids_of_images_to_show</span><span class="p">[</span><span class="n">row_num</span><span class="p">]]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
            <span class="n">grid</span><span class="p">[</span><span class="n">row_num</span> <span class="o">*</span> <span class="n">number_of_columns</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                <span class="sa">r</span><span class="s2">&quot;$\bf{&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Real~class&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;}$&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">class_id</span><span class="p">,</span><span class="w"> </span><span class="n">class_id</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$\bf{&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Predicted~class&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;}$&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">predicted_class</span><span class="p">,</span><span class="w"> </span><span class="n">predicted_class</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$\bf{&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Predicted~score&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;}$&quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">predicted_class_softmax</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="s2">&quot;large&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">grid</span><span class="p">[</span><span class="n">row_num</span> <span class="o">*</span> <span class="n">number_of_columns</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Examples of computed attributions&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">number_of_images</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">fig</span>

    <span class="k">def</span> <span class="nf">_check_is_after_evaluation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_results</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Methods are not evaluated yet. Please run .evaluate() first.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>

    <span class="k">def</span> <span class="nf">_check_is_after_aggregation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_after_evaluation</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_aggregation_results</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Results are not aggregated yet. Please run .aggregate() first.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>

    <span class="k">def</span> <span class="nf">_check_aggregation_parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">first_stage_aggregation_function_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">second_stage_aggregation_function_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_stage_aggregation_function_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;First stage aggregation function name must be a string. Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">first_stage_aggregation_function_name</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_stage_aggregation_function_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Second stage aggregation function name must be a string. Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">second_stage_aggregation_function_name</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">first_stage_aggregation_function_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_FIRST_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown first stage aggregation function: </span><span class="si">{</span><span class="n">first_stage_aggregation_function_name</span><span class="si">}</span><span class="s2">. Available functions: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_FIRST_STAGE_AGGREGATION_FUNCTIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">second_stage_aggregation_function_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_SECOND_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown second stage aggregation function: </span><span class="si">{</span><span class="n">second_stage_aggregation_function_name</span><span class="si">}</span><span class="s2">. Available functions: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_SECOND_STAGE_AGGREGATION_FUNCTIONS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">second_stage_aggregation_function_aggregation_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Second stage aggregation function parameters must be provided as a dictionary. Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Model must be of type torch.nn.Module.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>

    <span class="k">def</span> <span class="nf">_check_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data must be of type torch.Tensor.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data must be of shape (N, C, H, W).&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Targets must be of type torch.Tensor.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Targets must be of shape (N,).&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data and targets must have the same number of observations.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Provided data has NaN values.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">targets</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Targets have NaN values.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_method_and_metric_names</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">method_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span> <span class="n">metric_names</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">method_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="n">method_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Method names must be strings.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
                <span class="k">if</span> <span class="n">method_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_EXPLANATION_HANDLERS</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Unknown explanation method: </span><span class="si">{</span><span class="n">method_name</span><span class="si">}</span><span class="s2">. Available explanation methods: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_EXPLANATION_HANDLERS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="n">metric_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Metric names must be strings.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
                <span class="k">if</span> <span class="n">metric_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_METRIC_HANDLERS</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Unknown metric: </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">. Available metrics: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_METRIC_HANDLERS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>  <span class="c1"># noqa: TC003</span>

    <span class="k">def</span> <span class="nf">_check_method_and_metric_params_dicts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">metric_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">method_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">metric_params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">method_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method_params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Explanation parameters must be a dictionary.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
            <span class="k">for</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">method_param</span> <span class="ow">in</span> <span class="n">method_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">method_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_EXPLANATION_HANDLERS</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Unknown explanation method: </span><span class="si">{</span><span class="n">method_name</span><span class="si">}</span><span class="s2">. Available explanation methods: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_EXPLANATION_HANDLERS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">method_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">method_names</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Explanation method </span><span class="si">{</span><span class="n">method_name</span><span class="si">}</span><span class="s2"> is not in the list of methods to evaluate but the parameters were set for this method.&quot;</span><span class="p">,</span>
                        <span class="ne">UserWarning</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method_param</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Explanation method parameters must be provided as a dictionary. Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">method_param</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
                    <span class="p">)</span>
        <span class="k">if</span> <span class="n">metric_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric_params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Metric parameters must be a dictionary.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_param</span> <span class="ow">in</span> <span class="n">metric_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">metric_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_METRIC_HANDLERS</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Unknown metric: </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">. Available metrics: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_METRIC_HANDLERS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">metric_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2"> is not in the list of metrics to evaluate but the parameters were set for this metric.&quot;</span><span class="p">,</span>
                        <span class="ne">UserWarning</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric_param</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Metric parameters must be provided as a dictionary. Got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">metric_param</span><span class="p">)</span><span class="si">}</span><span class="s2"> instead.&quot;</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets seed for all random number generators.</span>
<span class="sd">        Args:</span>
<span class="sd">            seed (int): Seed for random number generators.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="autoexplainer.autoexplainer.AutoExplainer.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code>
          </td>
          <td><p>Convolutional neural network to be explained. On this model some explanation and metric
parameters will be inferred.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Data that will be used for explanation method evaluation. shape: (N, C, H, W).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>targets</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Labels for provided data. Encoded as integer vector with shape (N,).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>autoexplainer/autoexplainer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): Convolutional neural network to be explained. On this model some explanation and metric</span>
<span class="sd">            parameters will be inferred.</span>
<span class="sd">        data (torch.Tensor): Data that will be used for explanation method evaluation. shape: (N, C, H, W).</span>
<span class="sd">        targets (torch.Tensor): Labels for provided data. Encoded as integer vector with shape (N,).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_second_stage_aggregation_function_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_first_stage_aggregation_function_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">second_aggregation_results</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">fix_relus_in_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raw_results</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics_aggregated</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">times_total</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="autoexplainer.autoexplainer.AutoExplainer.aggregate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">aggregate</span><span class="p">(</span><span class="n">first_stage_aggregation_function_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">second_stage_aggregation_function_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;rank_based&#39;</span><span class="p">,</span> <span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Aggregates raw result computed in .evaluate() method in two steps. First, aggregates metric scores across
provided observations, i.e. each explanation method has a  value for each metric. Secondly, aggregates
scores across available metrics, i.e. each explanation method has a single value that represents overall quality.</p>
<p>Stores both aggregation steps in the attributes <code>first_aggregation_results</code> and <code>second_aggregation_results</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>first_stage_aggregation_function_name</code></td>
          <td>
                <code>{&#34;mean&#34;, &#34;median&#34;, &#34;min&#34;,&#34;max&#34;}</code>
          </td>
          <td><p>Name of the function for the first stage aggregation.</p></td>
          <td>
                <code>&#39;mean&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>second_stage_aggregation_function_name</code></td>
          <td>
                <code>{&#34;mean&#34;, &#34;median&#34;, &#34;min&#34;,&#34;max&#34;}</code>
          </td>
          <td><p>Name of the function for second stage aggregaton.</p></td>
          <td>
                <code>&#39;rank_based&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>second_stage_aggregation_function_aggregation_parameters</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Parameters for the second stage aggregation function.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>autoexplainer/autoexplainer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">first_stage_aggregation_function_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
    <span class="n">second_stage_aggregation_function_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rank_based&quot;</span><span class="p">,</span>
    <span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregates raw result computed in .evaluate() method in two steps. First, aggregates metric scores across</span>
<span class="sd">    provided observations, i.e. each explanation method has a  value for each metric. Secondly, aggregates</span>
<span class="sd">    scores across available metrics, i.e. each explanation method has a single value that represents overall quality.</span>

<span class="sd">    Stores both aggregation steps in the attributes ``first_aggregation_results`` and ``second_aggregation_results``.</span>

<span class="sd">    Args:</span>
<span class="sd">        first_stage_aggregation_function_name ({&quot;mean&quot;, &quot;median&quot;, &quot;min&quot;,&quot;max&quot;}): Name of the function for the first stage aggregation.</span>
<span class="sd">        second_stage_aggregation_function_name ({&quot;mean&quot;, &quot;median&quot;, &quot;min&quot;,&quot;max&quot;}): Name of the function for second stage aggregaton.</span>
<span class="sd">        second_stage_aggregation_function_aggregation_parameters (Dict): Parameters for the second stage aggregation function.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_after_evaluation</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_aggregation_parameters</span><span class="p">(</span>
        <span class="n">first_stage_aggregation_function_name</span><span class="p">,</span>
        <span class="n">second_stage_aggregation_function_name</span><span class="p">,</span>
        <span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_first_stage_aggregation_function_name</span> <span class="o">=</span> <span class="n">first_stage_aggregation_function_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_second_stage_aggregation_function_name</span> <span class="o">=</span> <span class="n">second_stage_aggregation_function_name</span>

    <span class="k">if</span> <span class="n">second_stage_aggregation_function_aggregation_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">second_stage_aggregation_function_aggregation_parameters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_FIRST_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">[</span>
        <span class="n">first_stage_aggregation_function_name</span>
    <span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_results</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">second_aggregation_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_SECOND_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">[</span>
        <span class="n">second_stage_aggregation_function_name</span>
    <span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span><span class="p">,</span> <span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">)</span>
    <span class="n">sorted_results</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">second_aggregation_results</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">best_result</span><span class="p">,</span> <span class="n">second_best_result</span> <span class="o">=</span> <span class="n">sorted_results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sorted_results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">best_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">second_best_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="p">[</span><span class="n">best_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="p">[</span><span class="n">second_best_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                <span class="n">best_result</span> <span class="o">=</span> <span class="n">second_best_result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span> <span class="o">=</span> <span class="n">best_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span> <span class="o">=</span> <span class="n">sorted_results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_parameters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;first_stage_aggregation_function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_FIRST_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">[</span>
            <span class="n">first_stage_aggregation_function_name</span>
        <span class="p">],</span>
        <span class="s2">&quot;second_stage_aggregation_function&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_SECOND_STAGE_AGGREGATION_FUNCTIONS</span><span class="p">[</span>
            <span class="n">second_stage_aggregation_function_name</span>
        <span class="p">],</span>
        <span class="s2">&quot;second_stage_aggregation_function_aggregation_parameters&quot;</span><span class="p">:</span> <span class="n">second_stage_aggregation_function_aggregation_parameters</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="autoexplainer.autoexplainer.AutoExplainer.evaluate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">explanations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">explanation_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">metrics_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Evaluates explanation methods. Stores results in <code>.raw_results</code> attribute.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>explanations</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>List of names of explanation methods to be evaluated.
                      By default, uses all available explanation methods.
                      Accepts lists with subset of: <code>{"saliency", "grad_cam", "integrated_gradients", "kernel_shap"}</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>metrics</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td><p>List of names of evaluation metrics to be used. By default, uses all available metrics.
                Accepts lists with subset of: <code>{"irof", "sparseness", "average_sensitivity", "faithfulness_estimate"}</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>explanation_params</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Dict">Dict</span>]</code>
          </td>
          <td><p>Allows to override default parameters of selected explanation functions.
                                Accept Dictionary with form <code>{"explanation_name": &lt;Dictionary with parameters&gt;}</code>.
                                See corresponding ExplanationHandler to see what parameters are accepted.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>metrics_params</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Dict">Dict</span>]</code>
          </td>
          <td><p>Allows to override default parameters of selected metrics.
                              Accept Dictionary with form <code>{"metric_name": &lt;Dictionary with parameters&gt;}</code>.
                              See corresponding MetricHandler to see what parameters are accepted.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>autoexplainer/autoexplainer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">explanations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">explanation_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">metrics_params</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluates explanation methods. Stores results in ``.raw_results`` attribute.</span>
<span class="sd">    Args:</span>
<span class="sd">        explanations (List[str]): List of names of explanation methods to be evaluated.</span>
<span class="sd">                                  By default, uses all available explanation methods.</span>
<span class="sd">                                  Accepts lists with subset of: ``{&quot;saliency&quot;, &quot;grad_cam&quot;, &quot;integrated_gradients&quot;, &quot;kernel_shap&quot;}``.</span>
<span class="sd">        metrics (List[str]): List of names of evaluation metrics to be used. By default, uses all available metrics.</span>
<span class="sd">                            Accepts lists with subset of: ``{&quot;irof&quot;, &quot;sparseness&quot;, &quot;average_sensitivity&quot;, &quot;faithfulness_estimate&quot;}``.</span>
<span class="sd">        explanation_params (Dict[str, Dict]): Allows to override default parameters of selected explanation functions.</span>
<span class="sd">                                            Accept Dictionary with form ``{&quot;explanation_name&quot;: &lt;Dictionary with parameters&gt;}``.</span>
<span class="sd">                                            See corresponding ExplanationHandler to see what parameters are accepted.</span>
<span class="sd">        metrics_params (Dict[str, Dict]): Allows to override default parameters of selected metrics.</span>
<span class="sd">                                          Accept Dictionary with form ``{&quot;metric_name&quot;: &lt;Dictionary with parameters&gt;}``.</span>
<span class="sd">                                          See corresponding MetricHandler to see what parameters are accepted.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_method_and_metric_names</span><span class="p">(</span><span class="n">explanations</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">explanations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">explanations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_EXPLANATION_HANDLERS</span>
    <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_METRIC_HANDLERS</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_method_and_metric_params_dicts</span><span class="p">(</span><span class="n">explanations</span><span class="p">,</span> <span class="n">metrics</span><span class="p">,</span> <span class="n">explanation_params</span><span class="p">,</span> <span class="n">metrics_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">explanation_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">explanation_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">metrics_params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">metrics_params</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Preparing explanation methods and metric handlers...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">explanation_name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_EXPLANATION_HANDLERS</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">](</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">explanation_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">explanation_name</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">explanation_name</span> <span class="ow">in</span> <span class="n">explanations</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">metric_name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">KNOWN_METRIC_HANDLERS</span><span class="p">[</span><span class="n">metric_name</span><span class="p">](</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span> <span class="n">metrics_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metrics</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="n">metric_name</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Number of explanation methods to evaluate: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Explanation methods selected: &quot;</span>
        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Number of metrics used during evaluation: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Metrics selected: &quot;</span>
        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">METRIC_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Creating attributions&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">explanation_name</span><span class="p">,</span> <span class="n">explanation_handler</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating attributions for </span><span class="si">{</span><span class="n">explanation_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">explanation_handler</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">explanation_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_results</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating attribution finished. Starting evaluation.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Evaluation may take a very long time, please be patient...&quot;</span><span class="p">)</span>

    <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span>
        <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">),</span>
        <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluating metrics&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_handler</span><span class="p">),</span> <span class="p">(</span><span class="n">explanation_name</span><span class="p">,</span> <span class="n">explanation_handler</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">pbar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluating: method </span><span class="si">{</span><span class="n">explanation_name</span><span class="si">}</span><span class="s2"> and metric </span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_results</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">][</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_handler</span><span class="o">.</span><span class="n">compute_metric_values</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="n">targets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
            <span class="n">attributions</span><span class="o">=</span><span class="n">explanation_handler</span><span class="o">.</span><span class="n">attributions</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
            <span class="n">explanation_func</span><span class="o">=</span><span class="n">explanation_handler</span><span class="o">.</span><span class="n">get_explanation_function</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">][</span><span class="n">explanation_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
            <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_methods</span><span class="p">[</span><span class="n">explanation_name</span><span class="p">],</span> <span class="mi">3</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics_aggregated</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">metric_name</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">times_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">times_total</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">times_metrics_aggregated</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluating metrics finished after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">times_total</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="autoexplainer.autoexplainer.AutoExplainer.get_best_explanation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_best_explanation</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">BestExplanation</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns an object with the selected best explanation method wrapped with a few additions, see BestExplanation for more details.
Returns (BestExplanation): BestExplanation object</p>

      <details class="quote">
        <summary>Source code in <code>autoexplainer/autoexplainer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_best_explanation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BestExplanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns an object with the selected best explanation method wrapped with a few additions, see BestExplanation for more details.</span>
<span class="sd">    Returns (BestExplanation): BestExplanation object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_after_aggregation</span><span class="p">()</span>
    <span class="n">best_explanation_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_handlers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">BestExplanation</span><span class="p">(</span>
        <span class="n">attributions</span><span class="o">=</span><span class="n">best_explanation_handler</span><span class="o">.</span><span class="n">attributions</span><span class="p">,</span>
        <span class="n">explanation_function</span><span class="o">=</span><span class="n">best_explanation_handler</span><span class="o">.</span><span class="n">get_explanation_function</span><span class="p">(),</span>
        <span class="n">explanation_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">best_explanation_name</span><span class="p">,</span>
        <span class="n">explanation_function_parameters</span><span class="o">=</span><span class="n">best_explanation_handler</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">,</span>
        <span class="n">metric_handlers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">,</span>
        <span class="n">aggregation_parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aggregation_parameters</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="autoexplainer.autoexplainer.AutoExplainer.to_html" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_html</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Generates evaluation report as HTML file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Target file path.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>model_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of model to show inside report.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>dataset_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of dataset to show inside report.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>labels</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[int, str]</code>
          </td>
          <td><p>Mapping between class number and class names. e.g. <code>{0:"dog", 1:"cat", 2:"fish"}</code> for labels
                    inside report.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>autoexplainer/autoexplainer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_html</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates evaluation report as HTML file.</span>
<span class="sd">    Args:</span>
<span class="sd">        file_path (str): Target file path.</span>
<span class="sd">        model_name (str): Name of model to show inside report.</span>
<span class="sd">        dataset_name (str): Name of dataset to show inside report.</span>
<span class="sd">        labels (Dict[int,str]): Mapping between class number and class names. e.g. ``{0:&quot;dog&quot;, 1:&quot;cat&quot;, 2:&quot;fish&quot;}`` for labels</span>
<span class="sd">                                inside report.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_aggregation_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Aggregated results are needed for report generation.&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_aggregation_results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Aggregated results are needed for report generation.&quot;</span>

    <span class="n">environment</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">PackageLoader</span><span class="p">(</span><span class="s2">&quot;autoexplainer&quot;</span><span class="p">))</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;report.html&quot;</span><span class="p">)</span>

    <span class="n">report_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info_for_report</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

    <span class="n">pic_io_bytes</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;fig_with_examples&quot;</span><span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pic_io_bytes</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
    <span class="n">pic_io_bytes</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">pic_hash</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">pic_io_bytes</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">float_columns</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;result_dataframe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>

    <span class="n">html_table</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;result_dataframe&quot;</span><span class="p">]</span>
        <span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_properties</span><span class="p">(</span>
            <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Agg. Score&quot;</span><span class="p">,</span> <span class="s2">&quot;Explanation Name&quot;</span><span class="p">],</span> <span class="o">**</span><span class="p">{</span><span class="s2">&quot;font-weight&quot;</span><span class="p">:</span> <span class="s2">&quot;bold&quot;</span><span class="p">,</span> <span class="s2">&quot;text-align&quot;</span><span class="p">:</span> <span class="s2">&quot;center&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="o">.</span><span class="n">set_properties</span><span class="p">(</span><span class="n">border</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">hide_index</span><span class="p">()</span>
        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.3f}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">float_columns</span><span class="p">)</span>
        <span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">rendered</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span>
        <span class="n">dataframe_html</span><span class="o">=</span><span class="n">html_table</span><span class="p">,</span>
        <span class="n">pic_hash</span><span class="o">=</span><span class="n">pic_hash</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
        <span class="o">**</span><span class="n">report_info</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="autoexplainer.autoexplainer.AutoExplainer.to_pdf" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_pdf</span><span class="p">(</span><span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;name of the model&#39;</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;name of the dataset&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Creates PDF report from dict stored in the attribute <code>first_aggregation_results</code>.
Needs Latex packages installed to run - see README.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>folder_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Path to directory, where the reports (PDF and tex) should be created.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>model_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of model to show inside report.</p></td>
          <td>
                <code>&#39;name of the model&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>dataset_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of dataset to show inside report.</p></td>
          <td>
                <code>&#39;name of the dataset&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>labels</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[int, str]</code>
          </td>
          <td><p>Mapping between class number and class names. e.g. <code>{0:"dog", 1:"cat", 2:"fish"}</code> for labels
                    inside report.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>autoexplainer/autoexplainer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_pdf</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name of the model&quot;</span><span class="p">,</span>
    <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;name of the dataset&quot;</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates PDF report from dict stored in the attribute ``first_aggregation_results``.</span>
<span class="sd">    Needs Latex packages installed to run - see README.</span>

<span class="sd">    Args:</span>
<span class="sd">        folder_path (str): Path to directory, where the reports (PDF and tex) should be created.</span>
<span class="sd">        model_name (str): Name of model to show inside report.</span>
<span class="sd">        dataset_name (str): Name of dataset to show inside report.</span>
<span class="sd">        labels (Dict[int,str]): Mapping between class number and class names. e.g. ``{0:&quot;dog&quot;, 1:&quot;cat&quot;, 2:&quot;fish&quot;}`` for labels</span>
<span class="sd">                                inside report.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_after_aggregation</span><span class="p">()</span>

    <span class="n">tex_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s2">&quot;report.tex&quot;</span><span class="p">)</span>
    <span class="n">pdf_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s2">&quot;report.pdf&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tex_file</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tex_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pdf_file</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pdf_file</span><span class="p">)</span>

    <span class="n">report_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info_for_report</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>

    <span class="n">left_margin</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">max_nr_columns_in_table</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">geometry_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tmargin&quot;</span><span class="p">:</span> <span class="s2">&quot;2cm&quot;</span><span class="p">,</span> <span class="s2">&quot;lmargin&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_margin</span><span class="si">}</span><span class="s2">cm&quot;</span><span class="p">}</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="n">geometry_options</span><span class="o">=</span><span class="n">geometry_options</span><span class="p">)</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;AutoeXplainer Report&quot;</span><span class="p">))</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">preamble</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Command</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Package</span><span class="p">(</span><span class="s2">&quot;hyperref&quot;</span><span class="p">))</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Package</span><span class="p">(</span><span class="s2">&quot;booktabs&quot;</span><span class="p">))</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\maketitle&quot;</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;result_dataframe&quot;</span><span class="p">]</span>

    <span class="n">metric_name_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">METRIC_NAME_SHORT_TO_LONG</span><span class="p">)</span>
    <span class="n">metric_name_copy</span><span class="p">[</span><span class="s2">&quot;explanation_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;explanation name&quot;</span>
    <span class="n">metric_name_copy</span><span class="p">[</span><span class="s2">&quot;Rank&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Rank&quot;</span>
    <span class="n">metric_name_copy</span><span class="p">[</span><span class="s2">&quot;Agg. Score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Agg. Score&quot;</span>
    <span class="n">explanation_methods</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;methods&quot;</span><span class="p">]</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span>
    <span class="n">metrics_used</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;explanation name&quot;</span><span class="p">,</span> <span class="s2">&quot;Rank&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">metrics</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Agg. Score&quot;</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hyperlink</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoEscape</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
        <span class="k">return</span> <span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\href{&quot;</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s2">&quot;}{&quot;</span> <span class="o">+</span> <span class="n">escape_latex</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">)</span>

    <span class="c1"># create content of  the Document</span>
    <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;General information&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Model name: &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Dataset name: &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Execution time: &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;execution_time&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> s </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Package version: &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;autoexplainer_version&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Date: &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Selected method: &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;selected_method&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Number of images: &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;n_images&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;Model performance&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Accuracy: &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;model_acc&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;F1 macro: &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;model_f1_macro&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Balanced accuracy: &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">italic</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;model_bac&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>

    <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;Table of results&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\begin</span><span class="si">{footnotesize}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\begin</span><span class="si">{flushleft}</span><span class="s2"> &quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;result_dataframe&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{flushleft}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{footnotesize}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="s2">&quot;Table description </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s2">&quot;Arrow next to the metric names indicates whether larger or smaller values of metric are better. Time elapsed shows time that was required for computation of attribution for given batch of images. When there is a tie in Aggregated Score, the best metric is chosen based on computation time.&quot;</span>
        <span class="p">)</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NewPage</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;Details&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
        <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s2">&quot;Explanations:&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
            <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Itemize</span><span class="p">())</span> <span class="k">as</span> <span class="n">itemize</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])):</span>
                    <span class="n">explanation_name</span> <span class="o">=</span> <span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">explanation_methods</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="n">itemize</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="n">explanation_name</span><span class="p">))</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EXPLANATION_DESCRIPTION</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">explanation_name</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">hyperlink</span><span class="p">(</span>
                            <span class="n">EXPLANATION_DESCRIPTION</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">explanation_name</span><span class="p">)][</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">EXPLANATION_DESCRIPTION</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">explanation_name</span><span class="p">)][</span><span class="mi">2</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Explanation&#39;s parameters: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\texttt{&quot;</span><span class="p">))</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;method_parameters&#39;</span><span class="p">][</span><span class="n">explanation_methods</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;}&quot;</span><span class="p">))</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NewPage</span><span class="p">())</span>
        <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s2">&quot;Metrics:&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
            <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Itemize</span><span class="p">())</span> <span class="k">as</span> <span class="n">itemize</span><span class="p">:</span>
                <span class="n">minus</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Time elapsed [s]&quot;</span><span class="p">:</span>
                        <span class="n">minus</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">itemize</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">bold</span><span class="p">(</span><span class="n">METRIC_NAME_MEDIUM_TO_LONG</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]]))</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">METRIC_DESCRIPTIONS</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">hyperlink</span><span class="p">(</span>
                                <span class="n">METRIC_DESCRIPTIONS</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">1</span><span class="p">],</span> <span class="n">METRIC_DESCRIPTIONS</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">2</span><span class="p">]</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Metric&#39;s parameters: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\texttt{&quot;</span><span class="p">))</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">report_info</span><span class="p">[</span><span class="s1">&#39;metric_parameters&#39;</span><span class="p">][</span><span class="n">metrics_used</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">minus</span><span class="p">]]</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;}&quot;</span><span class="p">))</span>
        <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Subsection</span><span class="p">(</span><span class="s2">&quot;Aggregation parameters&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\texttt{&quot;</span><span class="p">))</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;aggregation_parameters&quot;</span><span class="p">])</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NoEscape</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;}&quot;</span><span class="p">))</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NewPage</span><span class="p">())</span>
    <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Section</span><span class="p">(</span><span class="s2">&quot;Examples of explanations&quot;</span><span class="p">,</span> <span class="n">numbering</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
        <span class="k">with</span> <span class="n">doc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">Figure</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s2">&quot;!h&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">mini_logo</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">report_info</span><span class="p">[</span><span class="s2">&quot;fig_with_examples&quot;</span><span class="p">]</span>
            <span class="n">mini_logo</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">21</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">left_margin</span><span class="si">}</span><span class="s2">cm&quot;</span><span class="p">)</span>

    <span class="n">doc</span><span class="o">.</span><span class="n">generate_pdf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="s2">&quot;report&quot;</span><span class="p">),</span> <span class="n">clean_tex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div><h2 id="metric-handlers">Metric handlers</h2>


<div class="doc doc-object doc-module">


<a id="autoexplainer.metrics"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="autoexplainer.metrics.AvgSensitivityHandler" class="doc doc-heading">
        <code>AvgSensitivityHandler</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="autoexplainer.metrics.MetricHandler" href="#autoexplainer.metrics.MetricHandler">MetricHandler</a></code></p>

  
      <p>Metric Handler for Average Sensivity metric <a href="https://arxiv.org/abs/1901.09392">(Yeh et al., 2019)</a>.</p>
<p>Measures the average sensitivity of an explanation using a Monte Carlo sampling-based approximation.</p>
<p>Dictionary with parameters to override must be in the form:</p>
<pre><code>metric_parameters = {&quot;init&quot;: &lt;dictionary with parameters used in metric's __init__&gt;,
                   &quot;call&quot;: &lt;dictionary with parameters used in metric's __call__&gt;}
</code></pre>
<p>Parameters accepted in <code>metric_parameters</code>:</p>
<p><strong>"init"</strong>:</p>
<ul>
<li><code>abs</code>: a bool stating if absolute operation should be taken on the attributions</li>
<li><code>normalise</code>: a bool stating if the attributions should be normalised</li>
<li><code>normalise_func</code>: a Callable that make a normalising transformation of the attributions</li>
<li><code>lower_bound</code> (float): lower Bound of Perturbation, default=0.2</li>
<li><code>upper_bound</code> (None, float): upper Bound of Perturbation, default=None</li>
<li><code>nr_samples</code> (integer): the number of samples iterated, default=200.</li>
<li><code>norm_numerator</code> (callable): function for norm calculations on the numerator, default=fro_norm.</li>
<li><code>norm_denominator</code> (callable): function for norm calculations on the denominator, default=fro_norm.</li>
<li><code>perturb_func</code> (callable): input perturbation function, default=uniform_noise.</li>
<li><code>similarity_func</code> (callable): similarity function applied to compare input and perturbed input.</li>
</ul>
<p><strong>"call"</strong>: No parameters are used.</p>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/metrics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AvgSensitivityHandler</span><span class="p">(</span><span class="n">MetricHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metric Handler for Average Sensivity metric [(Yeh et al., 2019)](https://arxiv.org/abs/1901.09392).</span>

<span class="sd">    Measures the average sensitivity of an explanation using a Monte Carlo sampling-based approximation.</span>

<span class="sd">    Dictionary with parameters to override must be in the form:</span>
<span class="sd">    ```</span>
<span class="sd">    metric_parameters = {&quot;init&quot;: &lt;dictionary with parameters used in metric&#39;s __init__&gt;,</span>
<span class="sd">                       &quot;call&quot;: &lt;dictionary with parameters used in metric&#39;s __call__&gt;}</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters accepted in `metric_parameters`:</span>

<span class="sd">    **&quot;init&quot;**:</span>

<span class="sd">    - `abs`: a bool stating if absolute operation should be taken on the attributions</span>
<span class="sd">    - `normalise`: a bool stating if the attributions should be normalised</span>
<span class="sd">    - `normalise_func`: a Callable that make a normalising transformation of the attributions</span>
<span class="sd">    - `lower_bound` (float): lower Bound of Perturbation, default=0.2</span>
<span class="sd">    - `upper_bound` (None, float): upper Bound of Perturbation, default=None</span>
<span class="sd">    - `nr_samples` (integer): the number of samples iterated, default=200.</span>
<span class="sd">    - `norm_numerator` (callable): function for norm calculations on the numerator, default=fro_norm.</span>
<span class="sd">    - `norm_denominator` (callable): function for norm calculations on the denominator, default=fro_norm.</span>
<span class="sd">    - `perturb_func` (callable): input perturbation function, default=uniform_noise.</span>
<span class="sd">    - `similarity_func` (callable): similarity function applied to compare input and perturbed input.</span>

<span class="sd">    **&quot;call&quot;**: No parameters are used.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_metric_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">),</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_hide_output_parameters_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;call&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;cuda&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">metric_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">quantus</span><span class="o">.</span><span class="n">AvgSensitivity</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_infer_metric_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;normalise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;nr_samples&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s2">&quot;lower_bound&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="s2">&quot;norm_numerator&quot;</span><span class="p">:</span> <span class="n">quantus</span><span class="o">.</span><span class="n">fro_norm</span><span class="p">,</span>
            <span class="s2">&quot;norm_denominator&quot;</span><span class="p">:</span> <span class="n">quantus</span><span class="o">.</span><span class="n">fro_norm</span><span class="p">,</span>
            <span class="s2">&quot;perturb_func&quot;</span><span class="p">:</span> <span class="n">quantus</span><span class="o">.</span><span class="n">uniform_noise</span><span class="p">,</span>
            <span class="s2">&quot;similarity_func&quot;</span><span class="p">:</span> <span class="n">quantus</span><span class="o">.</span><span class="n">difference</span><span class="p">,</span>
            <span class="s2">&quot;perturb_radius&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoexplainer.metrics.FaithfulnessEstimateHandler" class="doc doc-heading">
        <code>FaithfulnessEstimateHandler</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="autoexplainer.metrics.MetricHandler" href="#autoexplainer.metrics.MetricHandler">MetricHandler</a></code></p>

  
      <p>Metric handler for Faithfulness Estimate metric <a href="https://arxiv.org/abs/1806.07538">(Alvarez-Melis et al., 2018)</a>.</p>
<p>Computes the correlation between probability drops and attribution scores on various points.</p>
<p>Dictionary with parameters to override must be in the form:</p>
<pre><code>metric_parameters = {&quot;init&quot;: &lt;dictionary with parameters used in metric's __init__&gt;,
                   &quot;call&quot;: &lt;dictionary with parameters used in metric's __call__&gt;}
</code></pre>
<p>Parameters accepted in <code>metric_parameters</code>:</p>
<p><strong>"init"</strong>:</p>
<ul>
<li><code>abs</code>: a bool stating if absolute operation should be taken on the attributions</li>
<li><code>normalise</code>: a bool stating if the attributions should be normalised</li>
<li><code>normalise_func</code>: a Callable that make a normalising transformation of the attributions</li>
<li><code>nr_runs</code> (integer): the number of runs (for each input and explanation pair), default=100.</li>
<li><code>subset_size</code> (integer): the size of subset, default=224.</li>
<li><code>perturb_baseline</code> (string): indicates the type of baseline: "mean", "random", "uniform", "black" or "white", default="mean".</li>
<li><code>similarity_func</code> (callable): Similarity function applied to compare input and perturbed input, default=correlation_spearman.</li>
<li><code>perturb_func</code> (callable): input perturbation function, default=baseline_replacement_by_indices.</li>
<li><code>features_in_step</code> (integer): the size of the step, default=256.</li>
<li><code>softmax</code> (boolean): indicates wheter to use softmax probabilities or logits in model prediction, default=True.</li>
</ul>
<p>"call": No parameters are used.</p>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/metrics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FaithfulnessEstimateHandler</span><span class="p">(</span><span class="n">MetricHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metric handler for Faithfulness Estimate metric [(Alvarez-Melis et al., 2018)](https://arxiv.org/abs/1806.07538).</span>

<span class="sd">    Computes the correlation between probability drops and attribution scores on various points.</span>

<span class="sd">    Dictionary with parameters to override must be in the form:</span>
<span class="sd">    ```</span>
<span class="sd">    metric_parameters = {&quot;init&quot;: &lt;dictionary with parameters used in metric&#39;s __init__&gt;,</span>
<span class="sd">                       &quot;call&quot;: &lt;dictionary with parameters used in metric&#39;s __call__&gt;}</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters accepted in `metric_parameters`:</span>

<span class="sd">    **&quot;init&quot;**:</span>

<span class="sd">    * `abs`: a bool stating if absolute operation should be taken on the attributions</span>
<span class="sd">    * `normalise`: a bool stating if the attributions should be normalised</span>
<span class="sd">    * `normalise_func`: a Callable that make a normalising transformation of the attributions</span>
<span class="sd">    * `nr_runs` (integer): the number of runs (for each input and explanation pair), default=100.</span>
<span class="sd">    * `subset_size` (integer): the size of subset, default=224.</span>
<span class="sd">    * `perturb_baseline` (string): indicates the type of baseline: &quot;mean&quot;, &quot;random&quot;, &quot;uniform&quot;, &quot;black&quot; or &quot;white&quot;, default=&quot;mean&quot;.</span>
<span class="sd">    * `similarity_func` (callable): Similarity function applied to compare input and perturbed input, default=correlation_spearman.</span>
<span class="sd">    * `perturb_func` (callable): input perturbation function, default=baseline_replacement_by_indices.</span>
<span class="sd">    * `features_in_step` (integer): the size of the step, default=256.</span>
<span class="sd">    * `softmax` (boolean): indicates wheter to use softmax probabilities or logits in model prediction, default=True.</span>

<span class="sd">    &quot;call&quot;: No parameters are used.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_metric_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_hide_output_parameters_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;cpu&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;call&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;call&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;cuda&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">metric_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">quantus</span><span class="o">.</span><span class="n">FaithfulnessEstimate</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_infer_metric_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;normalise&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;features_in_step&quot;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
            <span class="s2">&quot;perturb_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="s2">&quot;softmax&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoexplainer.metrics.IROFHandler" class="doc doc-heading">
        <code>IROFHandler</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="autoexplainer.metrics.MetricHandler" href="#autoexplainer.metrics.MetricHandler">MetricHandler</a></code></p>

  
      <p>Metric handler for Iterative Removal Of Features metric <a href="https://arxiv.org/abs/2003.08747">(Rieger at el., 2020)</a>.</p>
<p>Computes the area over the curve per class for sorted mean importances of feature segments (superpixels)
as they are iteratively removed (and prediction scores are collected), averaged over several test samples.</p>
<p>Dictionary with parameters to override must be in the form:</p>
<pre><code>metric_parameters = {&quot;init&quot;: &lt;dictionary with parameters used in metric's __init__&gt;,
                   &quot;call&quot;: &lt;dictionary with parameters used in metric's __call__&gt;}
</code></pre>
<p>Parameters accepted in <code>metric_parameters</code>:
"init":
- abs: a bool stating if absolute operation should be taken on the attributions
- normalise: a bool stating if the attributions should be normalised
- normalise_func: a Callable that make a normalising transformation of the attributions
- segmentation_method (string): Image segmentation method: 'slic' or 'felzenszwalb', default="slic"
- perturb_baseline (string): indicates the type of baseline: "mean", "random", "uniform", "black" or "white", default="mean"
- perturb_func (callable): input perturbation function, default=baseline_replacement_by_indices
- softmax (boolean): indicates wheter to use softmax probabilities or logits in model prediction</p>
<p>"call": No parameters are used.</p>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/metrics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IROFHandler</span><span class="p">(</span><span class="n">MetricHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metric handler for Iterative Removal Of Features metric [(Rieger at el., 2020)](https://arxiv.org/abs/2003.08747).</span>

<span class="sd">    Computes the area over the curve per class for sorted mean importances of feature segments (superpixels)</span>
<span class="sd">    as they are iteratively removed (and prediction scores are collected), averaged over several test samples.</span>

<span class="sd">    Dictionary with parameters to override must be in the form:</span>
<span class="sd">    ```</span>
<span class="sd">    metric_parameters = {&quot;init&quot;: &lt;dictionary with parameters used in metric&#39;s __init__&gt;,</span>
<span class="sd">                       &quot;call&quot;: &lt;dictionary with parameters used in metric&#39;s __call__&gt;}</span>
<span class="sd">    ```</span>
<span class="sd">    Parameters accepted in `metric_parameters`:</span>
<span class="sd">    &quot;init&quot;:</span>
<span class="sd">    - abs: a bool stating if absolute operation should be taken on the attributions</span>
<span class="sd">    - normalise: a bool stating if the attributions should be normalised</span>
<span class="sd">    - normalise_func: a Callable that make a normalising transformation of the attributions</span>
<span class="sd">    - segmentation_method (string): Image segmentation method: &#39;slic&#39; or &#39;felzenszwalb&#39;, default=&quot;slic&quot;</span>
<span class="sd">    - perturb_baseline (string): indicates the type of baseline: &quot;mean&quot;, &quot;random&quot;, &quot;uniform&quot;, &quot;black&quot; or &quot;white&quot;, default=&quot;mean&quot;</span>
<span class="sd">    - perturb_func (callable): input perturbation function, default=baseline_replacement_by_indices</span>
<span class="sd">    - softmax (boolean): indicates wheter to use softmax probabilities or logits in model prediction</span>

<span class="sd">    &quot;call&quot;: No parameters are used.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_irof_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">),</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_hide_output_parameters_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;call&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;cuda&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">metric_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">quantus</span><span class="o">.</span><span class="n">IterativeRemovalOfFeatures</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_infer_irof_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;segmentation_method&quot;</span><span class="p">:</span> <span class="s2">&quot;slic&quot;</span><span class="p">,</span>
            <span class="s2">&quot;perturb_baseline&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;softmax&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;return_aggregate&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoexplainer.metrics.MetricHandler" class="doc doc-heading">
        <code>MetricHandler</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Abstract class for metrics handlers.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code>
          </td>
          <td><p>Model used for metrics' parameters inference.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Data used for metrics' parameters inference.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>targets</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Target used for metrics' parameters inference.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>metric_parameters</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Metric parameters to overwrite inferred parameters. Dictionary must be in the form:</p>
<pre><code>                  ```
                  metric_parameters = {"init": &lt;dictionary with parameters used in metric's __init__&gt;,
                                       "call": &lt;dictionary with parameters used in metric's __call__&gt;}
                      ```
</code></pre></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>metric</code></td>
          <td>
                <code>quantus.<span title="quantus.Metric">Metric</span></code>
          </td>
          <td><p>Attribute that stores created metric object after determinig its parameters.</p></td>
        </tr>
        <tr>
          <td><code>metric_parameters</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Dictionary with parameters used for this metric.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/metrics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MetricHandler</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for metrics handlers.</span>



<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): Model used for metrics&#39; parameters inference.</span>
<span class="sd">        data (torch.Tensor): Data used for metrics&#39; parameters inference.</span>
<span class="sd">        targets (torch.Tensor): Target used for metrics&#39; parameters inference.</span>
<span class="sd">        metric_parameters (Dict): Metric parameters to overwrite inferred parameters. Dictionary must be in the form:</span>

<span class="sd">                                  ```</span>
<span class="sd">                                  metric_parameters = {&quot;init&quot;: &lt;dictionary with parameters used in metric&#39;s __init__&gt;,</span>
<span class="sd">                                                       &quot;call&quot;: &lt;dictionary with parameters used in metric&#39;s __call__&gt;}</span>
<span class="sd">                                      ```</span>


<span class="sd">    Attributes:</span>
<span class="sd">        metric (quantus.Metric): Attribute that stores created metric object after determinig its parameters.</span>
<span class="sd">        metric_parameters (Dict): Dictionary with parameters used for this metric.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">metric</span><span class="p">:</span> <span class="n">quantus</span><span class="o">.</span><span class="n">Metric</span> <span class="o">=</span> <span class="bp">NotImplemented</span>  <span class="c1"># type: ignore[no-any-unimported]</span>
    <span class="n">metric_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">compute_metric_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">attributions</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">explanation_func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes metric values for given model, dataset, and explanation function.</span>
<span class="sd">        Args:</span>
<span class="sd">            model:</span>
<span class="sd">            data:</span>
<span class="sd">            targets:</span>
<span class="sd">            attributions:</span>
<span class="sd">            explanation_func:</span>

<span class="sd">        Returns:</span>
<span class="sd">            NumPy array with metric values for each given image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_batch</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">y_batch</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">attributions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a_batch</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">attributions</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a_batch</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">result_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">x_batch</span><span class="o">=</span><span class="n">x_batch</span><span class="p">,</span>
                <span class="n">y_batch</span><span class="o">=</span><span class="n">y_batch</span><span class="p">,</span>
                <span class="n">a_batch</span><span class="o">=</span><span class="n">a_batch</span><span class="p">,</span>
                <span class="n">explain_func</span><span class="o">=</span><span class="n">explanation_func</span><span class="p">,</span>
                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;call&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span>

    <span class="k">def</span> <span class="nf">_add_hide_output_parameters_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;disable_warnings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;display_progressbar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">metric_parameters</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="autoexplainer.metrics.MetricHandler.compute_metric_values" class="doc doc-heading">
<code class="highlight language-python"><span class="n">compute_metric_values</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">attributions</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">explanation_func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Computes metric values for given model, dataset, and explanation function.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>targets</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>attributions</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>explanation_func</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>NumPy array with metric values for each given image.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>autoexplainer/metrics.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_metric_values</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">attributions</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">explanation_func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes metric values for given model, dataset, and explanation function.</span>
<span class="sd">    Args:</span>
<span class="sd">        model:</span>
<span class="sd">        data:</span>
<span class="sd">        targets:</span>
<span class="sd">        attributions:</span>
<span class="sd">        explanation_func:</span>

<span class="sd">    Returns:</span>
<span class="sd">        NumPy array with metric values for each given image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x_batch</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">y_batch</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">attributions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">a_batch</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">attributions</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a_batch</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
        <span class="n">result_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">x_batch</span><span class="o">=</span><span class="n">x_batch</span><span class="p">,</span>
            <span class="n">y_batch</span><span class="o">=</span><span class="n">y_batch</span><span class="p">,</span>
            <span class="n">a_batch</span><span class="o">=</span><span class="n">a_batch</span><span class="p">,</span>
            <span class="n">explain_func</span><span class="o">=</span><span class="n">explanation_func</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;call&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoexplainer.metrics.SparsenessHandler" class="doc doc-heading">
        <code>SparsenessHandler</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="autoexplainer.metrics.MetricHandler" href="#autoexplainer.metrics.MetricHandler">MetricHandler</a></code></p>

  
      <p>Metric Handler for Sparseness metric <a href="https://arxiv.org/abs/1810.06583">(Chalasani et al., 2020)</a>.</p>
<p>Uses the Gini Index for measuring, if only highly attributed features are truly predictive of the model output.</p>
<p>Dictionary with parameters to override must be in the form:</p>
<pre><code>metric_parameters = {&quot;init&quot;: &lt;dictionary with parameters used in metric's __init__&gt;,
                   &quot;call&quot;: &lt;dictionary with parameters used in metric's __call__&gt;}
</code></pre>
<p>Parameters accepted in <code>metric_parameters</code>:</p>
<p>"init":</p>
<ul>
<li>abs: a bool stating if absolute operation should be taken on the attributions</li>
<li>normalise: a bool stating if the attributions should be normalised</li>
<li>normalise_func: a Callable that make a normalising transformation of the attributions</li>
</ul>
<p>"call": No parameters are used.</p>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/metrics.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SparsenessHandler</span><span class="p">(</span><span class="n">MetricHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metric Handler for Sparseness metric [(Chalasani et al., 2020)](https://arxiv.org/abs/1810.06583).</span>

<span class="sd">    Uses the Gini Index for measuring, if only highly attributed features are truly predictive of the model output.</span>


<span class="sd">    Dictionary with parameters to override must be in the form:</span>
<span class="sd">    ```</span>
<span class="sd">    metric_parameters = {&quot;init&quot;: &lt;dictionary with parameters used in metric&#39;s __init__&gt;,</span>
<span class="sd">                       &quot;call&quot;: &lt;dictionary with parameters used in metric&#39;s __call__&gt;}</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters accepted in `metric_parameters`:</span>

<span class="sd">    &quot;init&quot;:</span>

<span class="sd">    - abs: a bool stating if absolute operation should be taken on the attributions</span>
<span class="sd">    - normalise: a bool stating if the attributions should be normalised</span>
<span class="sd">    - normalise_func: a Callable that make a normalising transformation of the attributions</span>

<span class="sd">    &quot;call&quot;: No parameters are used.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;init&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_sparsness_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">),</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_hide_output_parameters_to_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;cpu&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;call&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="s2">&quot;cuda&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">metric_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">,</span> <span class="n">metric_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">quantus</span><span class="o">.</span><span class="n">Sparseness</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_parameters</span><span class="p">[</span><span class="s2">&quot;init&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_infer_sparsness_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div><h2 id="explanation-methods-handlers">Explanation methods handlers</h2>


<div class="doc doc-object doc-module">


<a id="autoexplainer.explanations.explanation_handlers"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="autoexplainer.explanations.explanation_handlers.BestExplanation" class="doc doc-heading">
        <code>BestExplanation</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Class for an object that wraps the best explanation method selected during the evaluation process.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>attributions</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Attributions computed during evaluation using this explanation method only.</p></td>
        </tr>
        <tr>
          <td><code>explanation_function</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Function that computes attributions for the provided model and data.</p></td>
        </tr>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Name of this explanation method.</p></td>
        </tr>
        <tr>
          <td><code>parameters</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Parameters used in this explanation method.</p></td>
        </tr>
        <tr>
          <td><code>metric_handlers</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Dictionary with metric handlers that this explanation method was evaluated with.</p></td>
        </tr>
        <tr>
          <td><code>aggregation_parameters</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Parameter that were used during aggregation of metric values.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/explanations/explanation_handlers.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BestExplanation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for an object that wraps the best explanation method selected during the evaluation process.</span>

<span class="sd">    Attributes:</span>
<span class="sd">         attributions (torch.Tensor): Attributions computed during evaluation using this explanation method only.</span>
<span class="sd">         explanation_function (torch.Tensor): Function that computes attributions for the provided model and data.</span>
<span class="sd">         name (str): Name of this explanation method.</span>
<span class="sd">         parameters (Dict): Parameters used in this explanation method.</span>
<span class="sd">         metric_handlers (Dict): Dictionary with metric handlers that this explanation method was evaluated with.</span>
<span class="sd">         aggregation_parameters (Dict): Parameter that were used during aggregation of metric values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">attributions</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">explanation_function</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">metric_handlers</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">aggregation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">attributions</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">explanation_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">explanation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">explanation_function_parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">metric_handlers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
        <span class="n">aggregation_parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributions</span> <span class="o">=</span> <span class="n">attributions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span> <span class="o">=</span> <span class="n">explanation_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">explanation_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">explanation_function_parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span> <span class="o">=</span> <span class="n">metric_handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_parameters</span> <span class="o">=</span> <span class="n">aggregation_parameters</span>

    <span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute new attributions.</span>
<span class="sd">        Args:</span>
<span class="sd">            model (torch.nn.Module): CNN neural network to be explained.</span>
<span class="sd">            data (torch.Tensor): Data for which attributions will be computed. shape: (N, C, H, W).</span>
<span class="sd">            targets (torch.Tensor): Labels for provided data. Encoded as integer vector with shape (N,).</span>

<span class="sd">        Returns:</span>
<span class="sd">            attributions (torch.Tensor)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_model_and_data</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing attributions using </span><span class="si">{</span><span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2"> method.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This may take a while, depending on the number of samples to be explained.&quot;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">fix_relus_in_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">attributions_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Calculating attributions&quot;</span><span class="p">):</span>
                <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span><span class="p">(</span>
                    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                    <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
                    <span class="n">targets</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">attributions_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">attr</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">all_attributions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">attributions_list</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_attributions</span>

    <span class="k">def</span> <span class="nf">_check_model_and_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Model must be of type torch.nn.Module.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Data must be of type torch.Tensor.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data must be of shape (N, C, H, W).&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Targets must be of type torch.Tensor.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Targets must be of shape (N,).&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data and targets must have the same number of observations.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">attributions</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">aggregate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate the selected best explanation method again on new data.</span>
<span class="sd">        Args:</span>
<span class="sd">            model (torch.nn.Module): Convolutional neural network to be explained.</span>
<span class="sd">            data (torch.Tensor): Data that will be used for the evaluation of the explanation method. shape: (N, C, H, W).</span>
<span class="sd">            targets (torch.Tensor): Labels for provided data. Encoded as integer vector with shape (N,).</span>
<span class="sd">            attributions (torch.Tensor, optional): Attributions for this data that were previously computed, to skip computing them once more.</span>
<span class="sd">            aggregate (bool, optional): Indicates whether results should be aggregated (in the same manner as in AutoExplainer).</span>

<span class="sd">        Returns:</span>
<span class="sd">            results (Dict): Results of evaluation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_model_and_data</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attributions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_attributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">attributions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_bool</span><span class="p">(</span><span class="n">aggregate</span><span class="p">,</span> <span class="s2">&quot;aggregate&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Evaluating explanation method </span><span class="si">{</span><span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2"> using </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">)</span><span class="si">}</span><span class="s2"> metrics.&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Metrics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">METRIC_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This may take a long time, depending on the number of samples and metrics.&quot;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">fix_relus_in_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
            <span class="n">raw_results</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluating&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_handler</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="n">raw_results</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_handler</span><span class="o">.</span><span class="n">compute_metric_values</span><span class="p">(</span>
                    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
                    <span class="n">attributions</span><span class="o">=</span><span class="n">attributions</span><span class="p">,</span>
                    <span class="n">explanation_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">raw_results</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">raw_results</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">raw_results</span><span class="p">}</span>
            <span class="n">first_aggregation_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_parameters</span><span class="p">[</span><span class="s2">&quot;first_stage_aggregation_function&quot;</span><span class="p">](</span><span class="n">raw_results</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">first_aggregation_results</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_check_attributions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">attributions</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attributions</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Attributions must be of type torch.Tensor.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Attributions must be of shape (N, C, H, W).&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">attributions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data and targets must have the same number of observations.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">attributions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data and attributions must have the same image shape.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>

    <span class="k">def</span> <span class="nf">_check_is_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">value_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value  of </span><span class="si">{</span><span class="n">value_name</span><span class="si">}</span><span class="s2"> must be of type bool.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="autoexplainer.explanations.explanation_handlers.BestExplanation.evaluate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">attributions</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">aggregate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Evaluate the selected best explanation method again on new data.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code>
          </td>
          <td><p>Convolutional neural network to be explained.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Data that will be used for the evaluation of the explanation method. shape: (N, C, H, W).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>targets</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Labels for provided data. Encoded as integer vector with shape (N,).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>attributions</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Attributions for this data that were previously computed, to skip computing them once more.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>aggregate</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Indicates whether results should be aggregated (in the same manner as in AutoExplainer).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>results</code></td>          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Results of evaluation.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>autoexplainer/explanations/explanation_handlers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="n">attributions</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">aggregate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate the selected best explanation method again on new data.</span>
<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): Convolutional neural network to be explained.</span>
<span class="sd">        data (torch.Tensor): Data that will be used for the evaluation of the explanation method. shape: (N, C, H, W).</span>
<span class="sd">        targets (torch.Tensor): Labels for provided data. Encoded as integer vector with shape (N,).</span>
<span class="sd">        attributions (torch.Tensor, optional): Attributions for this data that were previously computed, to skip computing them once more.</span>
<span class="sd">        aggregate (bool, optional): Indicates whether results should be aggregated (in the same manner as in AutoExplainer).</span>

<span class="sd">    Returns:</span>
<span class="sd">        results (Dict): Results of evaluation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_model_and_data</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">attributions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_attributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">attributions</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_bool</span><span class="p">(</span><span class="n">aggregate</span><span class="p">,</span> <span class="s2">&quot;aggregate&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Evaluating explanation method </span><span class="si">{</span><span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2"> using </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">)</span><span class="si">}</span><span class="s2"> metrics.&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Metrics: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">METRIC_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This may take a long time, depending on the number of samples and metrics.&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">fix_relus_in_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
        <span class="n">raw_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric_handlers</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Evaluating&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">metric_handler</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">raw_results</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_handler</span><span class="o">.</span><span class="n">compute_metric_values</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
                <span class="n">attributions</span><span class="o">=</span><span class="n">attributions</span><span class="p">,</span>
                <span class="n">explanation_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">aggregate</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">raw_results</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">raw_results</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">raw_results</span><span class="p">}</span>
        <span class="n">first_aggregation_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_parameters</span><span class="p">[</span><span class="s2">&quot;first_stage_aggregation_function&quot;</span><span class="p">](</span><span class="n">raw_results</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">first_aggregation_results</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="autoexplainer.explanations.explanation_handlers.BestExplanation.explain" class="doc doc-heading">
<code class="highlight language-python"><span class="n">explain</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Compute new attributions.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code>
          </td>
          <td><p>CNN neural network to be explained.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Data for which attributions will be computed. shape: (N, C, H, W).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>targets</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Labels for provided data. Encoded as integer vector with shape (N,).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>attributions (torch.Tensor)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>autoexplainer/explanations/explanation_handlers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute new attributions.</span>
<span class="sd">    Args:</span>
<span class="sd">        model (torch.nn.Module): CNN neural network to be explained.</span>
<span class="sd">        data (torch.Tensor): Data for which attributions will be computed. shape: (N, C, H, W).</span>
<span class="sd">        targets (torch.Tensor): Labels for provided data. Encoded as integer vector with shape (N,).</span>

<span class="sd">    Returns:</span>
<span class="sd">        attributions (torch.Tensor)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_model_and_data</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing attributions using </span><span class="si">{</span><span class="n">EXPLANATION_NAME_SHORT_TO_LONG</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s2"> method.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This may take a while, depending on the number of samples to be explained.&quot;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">fix_relus_in_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
        <span class="n">attributions_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Calculating attributions&quot;</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">inputs</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
                <span class="n">targets</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">attributions_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">attr</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">all_attributions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">attributions_list</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">all_attributions</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoexplainer.explanations.explanation_handlers.ExplanationHandler" class="doc doc-heading">
        <code>ExplanationHandler</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Abstract class for explanation methods handlers. Handlers manage explanation methods: they read and adapt parameters for
given model and data. They also create explanation functions that may be used by the user or can be passed to metric handlers.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td>
                <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code>
          </td>
          <td><p>Model used for methods' parameter adaptation.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Data used for method's parameters adaptation. Tensor with shape (N, C, H, W)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>targets</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Target used for method's parameters inference - integer vector with shape (N,)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>explanation_parameters</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Explanation method parameters to be overwritten.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>explanation_function</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td><p>Explanation method as function ready to be used with already set parameters.</p></td>
        </tr>
        <tr>
          <td><code>explanation_parameters</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span></code>
          </td>
          <td><p>Parameters chosen for given explanation method.</p></td>
        </tr>
        <tr>
          <td><code>attributions</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td><p>Computed attributions, only most recent.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/explanations/explanation_handlers.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExplanationHandler</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for explanation methods handlers. Handlers manage explanation methods: they read and adapt parameters for</span>
<span class="sd">    given model and data. They also create explanation functions that may be used by the user or can be passed to metric handlers.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (torch.nn.Module): Model used for methods&#39; parameter adaptation.</span>
<span class="sd">        data (torch.Tensor): Data used for method&#39;s parameters adaptation. Tensor with shape (N, C, H, W)</span>
<span class="sd">        targets (torch.Tensor): Target used for method&#39;s parameters inference - integer vector with shape (N,)</span>
<span class="sd">        explanation_parameters (Dict): Explanation method parameters to be overwritten.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        explanation_function (Callable): Explanation method as function ready to be used with already set parameters.</span>
<span class="sd">        explanation_parameters (Dict): Parameters chosen for given explanation method.</span>
<span class="sd">        attributions (torch.Tensor): Computed attributions, only most recent.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">explanation_function</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="bp">NotImplemented</span>
    <span class="n">explanation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">attributions</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">explanation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">targets</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributions</span>

    <span class="k">def</span> <span class="nf">get_explanation_function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return function that can be run by Quantus metrics.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span>

    <span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span>

    <span class="k">def</span> <span class="nf">_create_mask_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask_parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
        <span class="n">mask_function_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">mask_parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mask_function_name&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">mask_parameters</span><span class="p">[</span><span class="s2">&quot;mask_function_name&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">batch_segmentation</span><span class="p">,</span> <span class="n">mask_function_name</span><span class="o">=</span><span class="n">mask_function_name</span><span class="p">,</span> <span class="o">**</span><span class="n">mask_parameters</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="autoexplainer.explanations.explanation_handlers.ExplanationHandler.get_explanation_function" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_explanation_function</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Callable</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Return function that can be run by Quantus metrics.</p>

      <details class="quote">
        <summary>Source code in <code>autoexplainer/explanations/explanation_handlers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_explanation_function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return function that can be run by Quantus metrics.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoexplainer.explanations.explanation_handlers.GradCamHandler" class="doc doc-heading">
        <code>GradCamHandler</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="autoexplainer.explanations.explanation_handlers.ExplanationHandler" href="#autoexplainer.explanations.explanation_handlers.ExplanationHandler">ExplanationHandler</a></code></p>

  
      <p>Handler for GradCam explanation method. Uses captum implementation of GradCam.</p>
<p>By default, the last convolutional layer is chosen as a parameter for GradCam.</p>
<p>To overwrite default parameters, passed dictionary must be in the form:</p>
<pre><code>explanation_parameters = {&quot;explanation_parameters&quot;:{ &lt;parameters accepted by GradCam in Captum&gt; }}
</code></pre>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/explanations/explanation_handlers.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GradCamHandler</span><span class="p">(</span><span class="n">ExplanationHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handler for GradCam explanation method. Uses captum implementation of GradCam.</span>

<span class="sd">    By default, the last convolutional layer is chosen as a parameter for GradCam.</span>

<span class="sd">    To overwrite default parameters, passed dictionary must be in the form:</span>
<span class="sd">    ```</span>
<span class="sd">    explanation_parameters = {&quot;explanation_parameters&quot;:{ &lt;parameters accepted by GradCam in Captum&gt; }}</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">explanation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_grad_cam_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">explanation_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">,</span> <span class="n">explanation_parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selected_layer&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognized model, you need to pass selected layer name for GradCam.&quot;</span><span class="p">)</span>  <span class="c1"># noqa: TC003</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">grad_cam</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_infer_grad_cam_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">layer_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_last_conv_layer_name</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;selected_layer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">layer_name</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;relu_attributions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">_get_last_conv_layer_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="n">last_conv_layer_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">named_modules</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">):</span>
                <span class="n">last_conv_layer_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">last_conv_layer_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">last_conv_layer_name</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoexplainer.explanations.explanation_handlers.IntegratedGradients" class="doc doc-heading">
        <code>IntegratedGradients</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="autoexplainer.explanations.explanation_handlers.ExplanationHandler" href="#autoexplainer.explanations.explanation_handlers.ExplanationHandler">ExplanationHandler</a></code></p>

  
      <p>Handler for Integrated Gradients explanation method. Uses implementation in Quantus library.</p>
<p>To overwrite default parameters, passed dictionary must be in the form:</p>
<pre><code>explanation_parameters = {&quot;explanation_parameters&quot;:{ &lt;parameters&gt; }}
</code></pre>
<p>Integrated Gradients method accepts paramteters:</p>
<ul>
<li><code>normalise</code> (Bool) - Normalize attribution values. default=False</li>
<li><code>abs</code> (bool) - Return absolute values of attribtuion. default=False</li>
<li>'pos_only` (bool) - Clip negative values of attribution to 0.0. default=False</li>
<li><code>neg_only</code> (bool) - Clip positive values of attribution to 0.0. default=False</li>
</ul>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/explanations/explanation_handlers.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">IntegratedGradients</span><span class="p">(</span><span class="n">ExplanationHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handler for Integrated Gradients explanation method. Uses implementation in Quantus library.</span>

<span class="sd">    To overwrite default parameters, passed dictionary must be in the form:</span>
<span class="sd">    ```</span>
<span class="sd">    explanation_parameters = {&quot;explanation_parameters&quot;:{ &lt;parameters&gt; }}</span>
<span class="sd">    ```</span>

<span class="sd">    Integrated Gradients method accepts paramteters:</span>

<span class="sd">    - `normalise` (Bool) - Normalize attribution values. default=False</span>
<span class="sd">    - `abs` (bool) - Return absolute values of attribtuion. default=False</span>
<span class="sd">    - &#39;pos_only` (bool) - Clip negative values of attribution to 0.0. default=False</span>
<span class="sd">    - `neg_only` (bool) - Clip positive values of attribution to 0.0. default=False</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># TODO: use original captum implementation instead Quantus&#39;. Quantus implementation have hardcoded parameters</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">explanation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_ig_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">explanation_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">,</span> <span class="n">explanation_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_map_baseline_function_name_to_function</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">integrated_gradients_explanation</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_infer_ig_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;baseline_function_name&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;n_steps&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">_map_baseline_function_name_to_function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;baseline_function&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BASELINE_FUNCTIONS</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;baseline_function_name&quot;</span><span class="p">]</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoexplainer.explanations.explanation_handlers.KernelShapHandler" class="doc doc-heading">
        <code>KernelShapHandler</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="autoexplainer.explanations.explanation_handlers.ExplanationHandler" href="#autoexplainer.explanations.explanation_handlers.ExplanationHandler">ExplanationHandler</a></code></p>

  
      <p>Handler for Kernel Shap explanation. Uses captum implementation of Kernel Shap. Accepts parameters with form:</p>
<p>To overwrite default parameters, passed dictionary must be in the form:</p>
<pre><code>explanation_parameters = {&quot;mask_parameters&quot;: { &quot;mask_function_name&quot;:&lt;str&gt;, &lt;other parameters for chosen mask function&gt; },
                   &quot;explanation_parameters&quot;:{ &quot;baseline_function_name&quot;:&lt;str&gt;, &lt;parameters accepted by KernelShap in Captum&gt; }}
</code></pre>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/explanations/explanation_handlers.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">KernelShapHandler</span><span class="p">(</span><span class="n">ExplanationHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handler for Kernel Shap explanation. Uses captum implementation of Kernel Shap. Accepts parameters with form:</span>

<span class="sd">    To overwrite default parameters, passed dictionary must be in the form:</span>
<span class="sd">    ```</span>
<span class="sd">    explanation_parameters = {&quot;mask_parameters&quot;: { &quot;mask_function_name&quot;:&lt;str&gt;, &lt;other parameters for chosen mask function&gt; },</span>
<span class="sd">                       &quot;explanation_parameters&quot;:{ &quot;baseline_function_name&quot;:&lt;str&gt;, &lt;parameters accepted by KernelShap in Captum&gt; }}</span>
<span class="sd">    ```</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">explanation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;mask_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_mask_parameters</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_kernel_shap_parameters</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">explanation_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">,</span> <span class="n">explanation_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_baseline_function</span><span class="p">()</span>
        <span class="n">mask_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_mask_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;mask_parameters&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">shap_explanation</span><span class="p">,</span> <span class="n">mask_function</span><span class="o">=</span><span class="n">mask_function</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># this method probably will be moved to the super class</span>
    <span class="k">def</span> <span class="nf">_infer_mask_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;mask_function_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;slic&quot;</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;n_segments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="k">return</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">_infer_kernel_shap_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;n_samples&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;baseline_function_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
        <span class="k">return</span> <span class="n">parameters</span>

    <span class="k">def</span> <span class="nf">_set_baseline_function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;baseline_function&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BASELINE_FUNCTIONS</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">][</span><span class="s2">&quot;baseline_function_name&quot;</span><span class="p">]</span>
        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="autoexplainer.explanations.explanation_handlers.SaliencyHandler" class="doc doc-heading">
        <code>SaliencyHandler</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="autoexplainer.explanations.explanation_handlers.ExplanationHandler" href="#autoexplainer.explanations.explanation_handlers.ExplanationHandler">ExplanationHandler</a></code></p>

  
      <p>Handler for Saliency explanation method. Uses implementation in Quantus library.</p>
<p>To overwrite default parameters, passed dictionary must be in the form:</p>
<pre><code>explanation_parameters = {&quot;explanation_parameters&quot;:{ &lt;parameters&gt; }}
</code></pre>
<p>Saliency method accepts paramteters:</p>
<ul>
<li><code>normalise</code> (Bool) - Normalize attribution values. default=False</li>
<li><code>abs</code> (bool) - Return absolute values of attribtuion. default=False</li>
<li>'pos_only` (bool) - Clip negative values of attribution to 0.0. default=False</li>
<li><code>neg_only</code> (bool) - Clip positive values of attribution to 0.0. default=False</li>
</ul>


        <details class="quote">
          <summary>Source code in <code>autoexplainer/explanations/explanation_handlers.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SaliencyHandler</span><span class="p">(</span><span class="n">ExplanationHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handler for Saliency explanation method. Uses implementation in Quantus library.</span>

<span class="sd">    To overwrite default parameters, passed dictionary must be in the form:</span>
<span class="sd">    ```</span>
<span class="sd">    explanation_parameters = {&quot;explanation_parameters&quot;:{ &lt;parameters&gt; }}</span>
<span class="sd">    ```</span>

<span class="sd">    Saliency method accepts paramteters:</span>

<span class="sd">    - `normalise` (Bool) - Normalize attribution values. default=False</span>
<span class="sd">    - `abs` (bool) - Return absolute values of attribtuion. default=False</span>
<span class="sd">    - &#39;pos_only` (bool) - Clip negative values of attribution to 0.0. default=False</span>
<span class="sd">    - `neg_only` (bool) - Clip positive values of attribution to 0.0. default=False</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">explanation_parameters</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_infer_saliency_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">explanation_parameters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">update_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">,</span> <span class="n">explanation_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation_function</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">saliency_explanation</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation_parameters</span><span class="p">[</span><span class="s2">&quot;explanation_parameters&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_infer_saliency_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;abs&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ba449ae6.min.js"></script>
      
    
  </body>
</html>